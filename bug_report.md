# Отчёт о тестировании GTA 2 Clone

## Обзор
Тестирование проводилось на локальном сервере `http://localhost:3000/`. Основное внимание было уделено перемещению игрока, управлению транспортными средствами, коллизиям и общему поведению игрового мира.

## Найденные баги и проблемы

### 1. Коллизии сущностей (Entity Collisions)

#### 1.1. Отсутствие коллизий между пешеходами
*   **Описание**: Игрок и NPC-пешеходы могут проходить сквозь друг друга без какого-либо физического взаимодействия.
*   **Приоритет**: Высокий
*   **Статус**: Подтверждено скриншотами.
*   **Предполагаемая причина**: Возможно, маски коллизий (`CollisionMask`) в `EntityCollisionSystem` настроены некорректно для типа `PEDESTRIAN`, либо пространственный хеш (`SpatialHash`) не находит мелкие объекты из-за малого радиуса поиска.

#### 1.2. Пешеходы проходят сквозь машины
*   **Описание**: Пешеходы (игрок и NPC) могут беспрепятственно заходить внутрь кузова автомобилей. Физического столкновения не происходит.
*   **Приоритет**: Критический
*   **Статус**: Подтверждено. Игрок может стоять в центре припаркованной или движущейся машины.

#### 1.3. Машины проходят сквозь пешеходов
*   **Описание**: При наезде автомобиля на пешехода физического контакта не происходит. Машина просто проезжает сквозь NPC или игрока. Смерть или урон не фиксируются.
*   **Приоритет**: Критический

### 2. Искусственный интеллект и трафик

#### 2.1. Спаун машин друг в друге
*   **Описание**: В некоторых случаях несколько автомобилей спаунятся в одной и той же точке дорожной сети, что приводит к их полному наложению друг на друга.
*   **Статус**: Подтверждено визуально (синяя и желтая машины на перекрестке).
*   **Причина**: Функция `spawnTrafficVehicle` в `TrafficAISystem.ts` не проверяет, свободна ли точка (waypoint) перед созданием новой сущности.

#### 2.2. Заторы и "глухие" пробки
*   **Описание**: Из-за того, что машины определяют друг друга как препятствия (`checkForObstacles`), но не могут разъехаться при сильном сближении/перекрытии, на дорогах возникают бесконечные пробки. Машины просто останавливаются и ждут вечно.

### 3. Рендеринг и визуализация

#### 3.1. Плейсхолдеры вместо текстур (Magenta Bars)
*   **Описание**: Барьеры на дорогах и некоторые элементы окружения отображаются ярко-розовым (magenta) цветом, что обычно указывает на отсутствие текстур или временные заглушки.
*   **Приоритет**: Низкий (косметический)

#### 3.2. Качество спрайтов
*   **Описание**: Большинство объектов (пешеходы, некоторые препятствия) представлены простыми геометрическими фигурами (зеленые квадраты). Хотя это ожидаемо для ранней стадии разработки, это затрудняет оценку визуальной части.

### 4. Физика и поверхности

#### 4.1. Снижение скорости на траве (Работает хорошо!)
*   **Наблюдение**: Машины корректно замедляются при съезде на зеленые плитки (траву). Это реализовано правильно через систему `SurfaceEffectSystem`.

#### 4.2. Столкновения машин между собой (Работает хорошо!)
*   **Наблюдение**: Автомобили отскакивают друг от друга при ударе, передавая импульс. Это одна из немногих систем коллизий, которая реально работает.

## Технические замечания
- Консоль браузера чиста, явных ошибок JS не зафиксировано.
- FPS стабильно держится на уровне 60.
- Перемещением управляют `EntityCollisionSystem` и `MapCollisionSystem` (последняя корректно обрабатывает столкновения пешехода с розовыми барьерами).

## Рекомендации по исправлению
1.  **Исправить SpatialHash**: Увеличить радиус поиска в `getNearby` до `radius + MAX_ENTITY_SIZE`, чтобы маленькие объекты "видели" большие.
2.  **Обновить логику коллизий**: В `checkEntityEntityCollision` убрать проверку `distSq > 0`, чтобы обрабатывать полностью перекрывающиеся объекты.
3.  **Добавить проверку занятости при спауне**: Модифицировать `spawnTrafficVehicle`, чтобы он проверял наличие других сущностей в радиусе 100-200 пикселей от точки спауна.
4.  **Смерть пешеходов**: Добавить вызов системы урона при срабатывании события `collision:entity` между машиной и пешеходом.
